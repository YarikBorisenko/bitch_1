<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Заняття 41: HTTP-запити + HTTPie (вбудовано)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"/>
  <style>
    body { background: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
    .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 3rem 0; }
    .card { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
    .output { background: #1a202c; color: #e2e8f0; padding: 1rem; border-radius: 8px; max-height: 300px; overflow-y: auto; }
    .terminal { background: #000; color: #0f0; padding: 1rem; border-radius: 8px; font-family: 'Courier New', monospace; }
    .terminal-input { background: transparent; border: none; color: #0f0; outline: none; width: 100%; }
    .toggle-header { cursor: pointer; font-weight: 600; color: #495057; }
    .toggle-header::after { content: " down arrow"; font-size: 0.8rem; }
    .toggle-header.collapsed::after { content: " right arrow"; }
    pre { margin: 0; }
  </style>
</head>
<body>

<div class="header text-center">
  <h1>Групове заняття №20</h1>
  <h3>Тема 4: Машинне навчання без учителя</h3>
  <h4>Заняття 41: Основи клієнт-серверних додатків</h4>
  <p>Теорія: 20 хв | Практика: 20 хв</p>
</div>

<div class="container py-4">

  <!-- Результати заняття -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#results">Результати заняття</div>
    <div id="results" class="collapse">
      <div class="card-body">
        <ol>
          <li>Пояснити суть HTTP-протоколу.</li>
          <li>Знати та вміти пояснити роботу веб-застосунків.</li>
          <li>Вміти на практиці застосувати Python для створення, реалізації та збереження запитів до сервера.</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Навчальні питання -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#questions">Навчальні питання</div>
    <div id="questions" class="collapse">
      <div class="card-body">
        <h5>1. Основи роботи веб-застосунків</h5>
        <p><strong>Теорія – 20 хв, практика – 20 хв</strong></p>
        <ul>
          <li>Веб-застосунок — програма, що виконує функції через браузер.</li>
          <li>На відміну від традиційних, веб-застосунки доступні онлайн і не потребують встановлення.</li>
        </ul>
        <h6>Загальний вигляд взаємодії між клієнтом та сервером:</h6>
        <p class="text-center"><em>[Діаграма: Клієнт → Запит → Сервер → Відповідь]</em></p>
        <p><strong>Приклад POST-запиту:</strong></p>
        <pre><code>POST /api/login HTTP/1.1
Host: example.com
Content-Type: application/json

{
  "username": "user123",
  "password": "securePass"
}</code></pre>
      </div>
    </div>
  </div>

  <!-- 1.1 Методи запитів -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#methods">1.1 Методи запитів</div>
    <div id="methods" class="collapse">
      <div class="card-body">
        <table class="table table-bordered">
          <thead class="table-light"><tr><th>Метод</th><th>Призначення</th></tr></thead>
          <tbody>
            <tr><td>GET</td><td>Отримання даних</td></tr>
            <tr><td>POST</td><td>Надсилання даних</td></tr>
            <tr><td>PUT</td><td>Оновлення</td></tr>
            <tr><td>DELETE</td><td>Видалення</td></tr>
            <tr><td>PATCH</td><td>Часткове оновлення</td></tr>
            <tr><td>HEAD</td><td>Як GET, але без тіла</td></tr>
            <tr><td>OPTIONS</td><td>Доступні методи</td></tr>
          </tbody>
        </table>
        <p><strong>GET-запит:</strong> <code>GET /products HTTP/1.1</code></p>
        <p><strong>POST-запит:</strong> <code>POST /login HTTP/1.1</code></p>
      </div>
    </div>
  </div>

  <!-- 1.2 Заголовки -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#headers">1.2 Заголовки запитів (HTTP Headers)</div>
    <div id="headers" class="collapse">
      <div class="card-body">
        <table class="table table-bordered">
          <thead class="table-light"><tr><th>Заголовок</th><th>Призначення</th></tr></thead>
          <tbody>
            <tr><td>Content-Type</td><td>Тип даних</td></tr>
            <tr><td>Authorization</td><td>Токен доступу</td></tr>
            <tr><td>User-Agent</td><td>Ідентифікація клієнта</td></tr>
            <tr><td>Accept</td><td>Тип відповіді</td></tr>
            <tr><td>Host</td><td>Домен сервера</td></tr>
            <tr><td>Cookie</td><td>Сесія</td></tr>
          </tbody>
        </table>
        <p><strong>Приклад:</strong></p>
        <pre><code>GET /api/products HTTP/1.1
Host: example.com
Authorization: Bearer eyJhbGci...
Accept: application/json</code></pre>
      </div>
    </div>
  </div>

  <!-- 1.3 Створення запитів (HTTPie) -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#httpie">1.3 Створення запитів (HTTPie)</div>
    <div id="httpie" class="collapse">
      <div class="card-body">
        <p><strong>HTTPie</strong> — інструмент для тестування. Онлайн: <a href="https://httpie.io" target="_blank">httpie.io</a></p>
        <h6>Емулятор терміналу (вбудований):</h6>
        <div class="terminal">
          <div>$ <input id="httpie-cmd" class="terminal-input" placeholder="http GET https://httpbin.org/headers..." /></div>
          <button class="btn btn-sm btn-success mt-2" onclick="runHttpie()">Виконати</button>
        </div>
        <div id="httpie-output" class="output mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Практичне завдання 1 -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#task1">Практичне завдання 1</div>
    <div id="task1" class="collapse">
      <div class="card-body">
        <p><strong>Завдання:</strong></p>
        <ol>
          <li>Отримати HTML-сторінку методом GET.</li>
          <li>Завантажити JSON та зберегти на диск.</li>
        </ol>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">URL (HTML)</label>
            <input id="url-html" class="form-control" value="https://httpbin.org/html" />
          </div>
          <div class="col-md-6">
            <label class="form-label">URL (JSON)</label>
            <input id="url-json" class="form-control" value="https://jsonplaceholder.typicode.com/todos/1" />
          </div>
        </div>

        <button class="btn btn-success mt-3" onclick="runTask1()">Виконати</button>
        <button class="btn btn-outline-primary mt-3 ms-2" onclick="downloadFile('task1-html')">Скачати HTML</button>
        <button class="btn btn-outline-primary mt-3 ms-2" onclick="downloadFile('task1-json')">Скачати JSON</button>

        <div id="output1" class="output mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Практичне завдання 2 -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#task2">Практичне завдання 2</div>
    <div id="task2" class="collapse">
      <div class="card-body">
        <p><strong>Завдання:</strong></p>
        <ul>
          <li>Використати мову: німецька</li>
          <li>Вказати User-Agent</li>
          <li>Використати <a href="https://httpie.io" target="_blank">httpie.io</a></li>
        </ul>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Мова</label>
            <select id="lang" class="form-select">
              <option value="de">Німецька (de)</option>
              <option value="en">English (en)</option>
              <option value="uk">Українська (uk)</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">User-Agent</label>
            <input id="ua" class="form-control" value="Mozilla/5.0 (Windows NT 10.0; Win64; x64)" />
          </div>
        </div>

        <button class="btn btn-info mt-3" onclick="runTask2()">Надіслати</button>
        <div id="output2" class="output mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Практичне завдання 3 -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#task3">Практичне завдання 3</div>
    <div id="task3" class="collapse">
      <div class="card-body">
        <p><strong>Завдання:</strong></p>
        <ol>
          <li>Завантажити HTML з імітацією браузера.</li>
          <li>Завантажити <code>todos.json</code>.</li>
        </ol>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">URL</label>
            <input id="url-page" class="form-control" value="https://httpbin.org/headers" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Браузер</label>
            <select id="browser" class="form-select">
              <option value="Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X)...">iPhone Safari</option>
              <option value="Mozilla/5.0 (Windows NT 10.0; Win64; x64)...">Chrome Windows</option>
            </select>
          </div>
        </div>

        <button class="btn btn-warning mt-3" onclick="runTask3()">Виконати</button>
        <button class="btn btn-outline-primary mt-3 ms-2" onclick="downloadFile('task3-html')">Скачати HTML</button>
        <button class="btn btn-outline-success mt-3 ms-2" onclick="downloadTodos()">Скачати todos.json</button>

        <div id="output3" class="output mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Python requests -->
  <div class="card">
    <div class="card-header toggle-header collapsed" data-bs-toggle="collapse" data-bs-target="#python">Python (requests)</div>
    <div id="python" class="collapse">
      <div class="card-body">
        <pre><code class="language-python" id="pycode">
import requests, json

# Отримання HTML
url = "https://httpbin.org/html"
response = requests.get(url)
print("Status:", response.status_code)
print(response.text[:500])

# JSON + збереження
url = "https://jsonplaceholder.typicode.com/todos/1"
data = requests.get(url).json()
with open("downloaded_todo.json", "w", encoding="utf-8") as f:
    json.dump(data, f, ensure_ascii=False, indent=4)
print("JSON збережено")
        </code></pre>
        <button class="btn btn-sm btn-outline-light" onclick="copyCode()">Копіювати</button>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

<script>
  let task1Html = "", task1Json = "", task3Html = "", todosData = null;

  function showOutput(id, content) {
    const el = document.getElementById(id);
    el.style.display = "block";
    el.innerHTML = content.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;');
  }

  async function runTask1() {
    const htmlUrl = document.getElementById("url-html").value;
    const jsonUrl = document.getElementById("url-json").value;

    try {
      const [htmlResp, jsonResp] = await Promise.all([fetch(htmlUrl), fetch(jsonUrl)]);
      task1Html = await htmlResp.text();
      task1Json = JSON.stringify(await jsonResp.json(), null, 2);
      showOutput("output1", `<strong>HTML: ${task1Html.length} символів</strong><br><br><pre>${task1Json}</pre>`);
    } catch (e) {
      showOutput("output1", `Помилка: ${e.message}`);
    }
  }

  async function runTask2() {
    const lang = document.getElementById("lang").value;
    const ua = document.getElementById("ua").value;
    try {
      const resp = await fetch("https://httpbin.org/headers", {
        headers: { "Accept-Language": lang, "User-Agent": ua }
      });
      const data = await resp.json();
      showOutput("output2", `<pre>${JSON.stringify(data, null, 2)}</pre>`);
    } catch (e) {
      showOutput("output2", `Помилка: ${e.message}`);
    }
  }

  async function runTask3() {
    const url = document.getElementById("url-page").value;
    const ua = document.getElementById("browser").value;
    try {
      const [pageResp, todosResp] = await Promise.all([
        fetch(url, { headers: { "User-Agent": ua } }),
        fetch("https://jsonplaceholder.typicode.com/todos")
      ]);
      task3Html = await pageResp.text();
      todosData = await todosResp.json();
      showOutput("output3", `<strong>Сторінка: ${task3Html.length} символів</strong><br><strong>Todos: ${todosData.length} записів</strong>`);
    } catch (e) {
      showOutput("output3", `Помилка: ${e.message}`);
    }
  }

  function downloadFile(type) {
    let content = "", filename = "", mime = "";
    if (type === "task1-html") { content = task1Html; filename = "page.html"; mime = "text/html"; }
    if (type === "task1-json") { content = task1Json; filename = "todo.json"; mime = "application/json"; }
    if (type === "task3-html") { content = task3Html; filename = "custom_page.html"; mime = "text/html"; }
    if (!content) return alert("Спочатку виконайте завдання");
    const blob = new Blob([content], { type: mime });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = filename; a.click();
    URL.revokeObjectURL(url);
  }

  function downloadTodos() {
    if (!todosData) return alert("Спочатку виконайте завдання 3");
    const blob = new Blob([JSON.stringify(todosData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = "todos.json"; a.click();
    URL.revokeObjectURL(url);
  }

  function copyCode() {
    const code = document.getElementById("pycode").textContent;
    navigator.clipboard.writeText(code).then(() => alert("Код скопійовано!"));
  }

  // Емулятор HTTPie
  async function runHttpie() {
    const cmd = document.getElementById("httpie-cmd").value.trim();
    if (!cmd.startsWith("http ")) {
      showOutput("httpie-output", "Використовуйте: http GET/POST ...");
      return;
    }

    const parts = cmd.split(" ");
    const method = parts[1].toUpperCase();
    const url = parts[2];
    const headers = {};
    for (let i = 3; i < parts.length; i++) {
      if (parts[i].includes(":")) {
        const [k, v] = parts[i].split(":");
        headers[k] = v;
      }
    }

    try {
      const resp = await fetch(url, { method, headers });
      const text = await resp.text();
      showOutput("httpie-output", `<pre style="color:#0f0">${resp.status} ${resp.statusText}\n${JSON.stringify(resp.headers, null, 2)}\n\n${text}</pre>`);
    } catch (e) {
      showOutput("httpie-output", `Помилка: ${e.message}`);
    }
  }
</script>

</body>
</html>
