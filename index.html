<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Заняття 41: HTTP-запити (інтерактив)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"/>
  <style>
    body { background: #f4f6f9; font-family: 'Segoe UI', sans-serif; }
    .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 3rem 0; }
    .card { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
    .code-block { background: #2d3748; color: #e2e8f0; padding: 1rem; border-radius: 8px; font-family: 'Courier New', monospace; }
    .copy-btn { font-size: 0.8rem; }
    .output { background: #1a202c; color: #e2e8f0; padding: 1rem; border-radius: 8px; max-height: 300px; overflow-y: auto; }
    .download-btn { margin-top: 0.5rem; }
    .toggle-header { cursor: pointer; font-weight: 600; color: #495057; }
    .toggle-header::after { content: " ▼"; font-size: 0.8rem; }
    .toggle-header.collapsed::after { content: " ►"; }
    pre { margin: 0; }
  </style>
</head>
<body>

<div class="header text-center">
  <h1>Групове заняття №20</h1>
  <h3>Тема 4: Машинне навчання без учителя</h3>
  <h4>Заняття 41: Основи клієнт-серверних додатків</h4>
</div>

<div class="container py-4">

  <!-- Результати заняття -->
  <div class="card">
    <div class="card-header toggle-header" data-bs-toggle="collapse" data-bs-target="#results">Результати заняття</div>
    <div id="results" class="collapse show">
      <div class="card-body">
        <ol>
          <li>Пояснити суть HTTP-протоколу.</li>
          <li>Знати та пояснити роботу веб-застосунків.</li>
          <li>Застосувати Python для запитів до сервера.</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Практичне завдання 1 -->
  <div class="card">
    <div class="card-header toggle-header" data-bs-toggle="collapse" data-bs-target="#task1">Практичне завдання 1</div>
    <div id="task1" class="collapse show">
      <div class="card-body">
        <p><strong>Завдання:</strong></p>
        <ol>
          <li>Отримати HTML-сторінку методом GET.</li>
          <li>Завантажити JSON та зберегти на диск.</li>
        </ol>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">URL (HTML)</label>
            <input id="url-html" class="form-control" value="https://httpbin.org/html" />
          </div>
          <div class="col-md-6">
            <label class="form-label">URL (JSON)</label>
            <input id="url-json" class="form-control" value="https://jsonplaceholder.typicode.com/todos/1" />
          </div>
        </div>

        <button class="btn btn-success mt-3" onclick="runTask1()">Виконати</button>
        <button class="btn btn-outline-primary mt-3 ms-2" onclick="downloadFile('task1-html', 'text/html')">Скачати HTML</button>
        <button class="btn btn-outline-primary mt-3 ms-2" onclick="downloadFile('task1-json', 'application/json')">Скачати JSON</button>

        <div id="output1" class="output mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Практичне завдання 2 -->
  <div class="card">
    <div class="card-header toggle-header" data-bs-toggle="collapse" data-bs-target="#task2">Практичне завдання 2</div>
    <div id="task2" class="collapse show">
      <div class="card-body">
        <p><strong>Запит з кастомними заголовками (Accept-Language: de, User-Agent)</strong></p>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Мова</label>
            <select id="lang" class="form-select">
              <option value="de">Німецька (de)</option>
              <option value="en">English (en)</option>
              <option value="uk">Українська (uk)</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">User-Agent</label>
            <input id="ua" class="form-control" value="Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/130" />
          </div>
        </div>

        <button class="btn btn-info mt-3" onclick="runTask2()">Надіслати запит</button>

        <div id="output2" class="output mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Практичне завдання 3 -->
  <div class="card">
    <div class="card-header toggle-header" data-bs-toggle="collapse" data-bs-target="#task3">Практичне завдання 3</div>
    <div id="task3" class="collapse show">
      <div class="card-body">
        <p><strong>Завдання:</strong></p>
        <ol>
          <li>Завантажити сторінку з імітацією браузера.</li>
          <li>Завантажити todos.json.</li>
        </ol>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">URL сторінки</label>
            <input id="url-page" class="form-control" value="https://httpbin.org/" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Браузер</label>
            <select id="browser" class="form-select">
              <option value="Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X)...">iPhone Safari</option>
              <option value="Mozilla/5.0 (Windows NT 10.0; Win64; x64)...">Chrome Windows</option>
            </select>
          </div>
        </div>

        <button class="btn btn-warning mt-3" onclick="runTask3()">Виконати</button>
        <button class="btn btn-outline-primary mt-3 ms-2" onclick="downloadFile('task3-html', 'text/html')">Скачати HTML</button>
        <button class="btn btn-outline-success mt-3 ms-2" onclick="downloadTodos()">Скачати todos.json</button>

        <div id="output3" class="output mt-3" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Таблиця HTTP-методів -->
  <div class="card">
    <div class="card-header toggle-header" data-bs-toggle="collapse" data-bs-target="#methods">HTTP-методи</div>
    <div id="methods" class="collapse show">
      <div class="card-body">
        <table class="table table-bordered">
          <thead class="table-light"><tr><th>Метод</th><th>Призначення</th></tr></thead>
          <tbody>
            <tr><td>GET</td><td>Отримання даних</td></tr>
            <tr><td>POST</td><td>Надсилання даних</td></tr>
            <tr><td>PUT</td><td>Оновлення ресурсу</td></tr>
            <tr><td>DELETE</td><td>Видалення</td></tr>
            <tr><td>PATCH</td><td>Часткове оновлення</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Приклад коду Python -->
  <div class="card">
    <div class="card-header toggle-header" data-bs-toggle="collapse" data-bs-target="#code">Приклад Python (requests)</div>
    <div id="code" class="collapse show">
      <div class="card-body">
        <pre><code class="language-python" id="pycode">
import requests, json

url = "https://httpbin.org/headers"
headers = {"User-Agent": "CustomBot/1.0", "Accept-Language": "uk"}
response = requests.get(url, headers=headers)
print(response.json())
        </code></pre>
        <button class="btn btn-sm btn-outline-light copy-btn" onclick="copyCode()">Копіювати код</button>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

<script>
  let task1Html = "", task1Json = "", task3Html = "";

  function showOutput(id, content) {
    const el = document.getElementById(id);
    el.style.display = "block";
    el.textContent = content;
  }

  async function runTask1() {
    const htmlUrl = document.getElementById("url-html").value;
    const jsonUrl = document.getElementById("url-json").value;

    try {
      const [htmlResp, jsonResp] = await Promise.all([
        fetch(htmlUrl), fetch(jsonUrl)
      ]);

      task1Html = await htmlResp.text();
      task1Json = JSON.stringify(await jsonResp.json(), null, 2);

      showOutput("output1", `HTML отримано (${task1Html.length} символів)\n\nJSON:\n${task1Json}`);
    } catch (e) {
      showOutput("output1", "Помилка: " + e.message);
    }
  }

  async function runTask2() {
    const lang = document.getElementById("lang").value;
    const ua = document.getElementById("ua").value;

    try {
      const resp = await fetch("https://httpbin.org/headers", {
        headers: { "Accept-Language": lang, "User-Agent": ua }
      });
      const data = await resp.json();
      showOutput("output2", JSON.stringify(data, null, 2));
    } catch (e) {
      showOutput("output2", "Помилка: " + e.message);
    }
  }

  async function runTask3() {
    const url = document.getElementById("url-page").value;
    const ua = document.getElementById("browser").value;

    try {
      const [pageResp, todosResp] = await Promise.all([
        fetch(url, { headers: { "User-Agent": ua } }),
        fetch("https://jsonplaceholder.typicode.com/todos")
      ]);

      task3Html = await pageResp.text();
      const todos = await todosResp.json();

      showOutput("output3", `Сторінка: ${task3Html.length} символів\n\nTodos: ${todos.length} записів`);
      window.todosData = todos;
    } catch (e) {
      showOutput("output3", "Помилка: " + e.message);
    }
  }

  function downloadFile(type, mime) {
    let content = "";
    let filename = "";

    if (type === "task1-html") { content = task1Html; filename = "page.html"; }
    if (type === "task1-json") { content = task1Json; filename = "todo.json"; }
    if (type === "task3-html") { content = task3Html; filename = "custom_page.html"; }

    const blob = new Blob([content], { type: mime });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename; a.click();
    URL.revokeObjectURL(url);
  }

  function downloadTodos() {
    if (!window.todosData) return alert("Спочатку виконайте завдання 3");
    const blob = new Blob([JSON.stringify(window.todosData, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "todos.json"; a.click();
    URL.revokeObjectURL(url);
  }

  function copyCode() {
    const code = document.getElementById("pycode").textContent;
    navigator.clipboard.writeText(code).then(() => alert("Код скопійовано!"));
  }
</script>

</body>
</html>